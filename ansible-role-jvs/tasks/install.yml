---
# Installation tasks for JVS

- name: Check if JVS is already installed
  command: "{{ jvs_bin_dir }}/jvs version"
  register: jvs_installed
  failed_when: false
  changed_when: false
  tags: ['jvs', 'install']

- name: Set current version if installed
  set_fact:
    jvs_current_version: "{{ jvs_installed.stdout_lines[0].split()[-1] }}"
  when: jvs_installed.rc == 0
  tags: ['jvs', 'install']

- name: Display JVS installation status
  debug:
    msg: "JVS {{ jvs_current_version | default('not installed') }} -> {{ jvs_version }}"
  tags: ['jvs', 'install']

- name: Install JVS from GitHub release
  include_tasks: install_release.yml
  when:
    - jvs_install_method == 'release'
    - (jvs_installed.rc != 0 or jvs_current_version != jvs_version)
  tags: ['jvs', 'install']

- name: Install JVS from source
  include_tasks: install_source.yml
  when:
    - jvs_install_method == 'source'
    - (jvs_installed.rc != 0 or jvs_version == 'source')
  tags: ['jvs', 'install']

- name: Create profile.d script for JVS
  template:
    src: jvs.sh.j2
    dest: /etc/profile.d/jvs.sh
    mode: '0644'
  when: jvs_profile_d
  tags: ['jvs', 'install']
