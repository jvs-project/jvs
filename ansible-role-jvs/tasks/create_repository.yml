---
# Create a single JVS repository

- name: Check if repository exists
  stat:
    path: "{{ repo_path }}/.jvs"
  register: repo_stat

- name: Create JVS repository
  command: "{{ jvs_bin_dir }}/jvs init {{ repo_name }}"
  args:
    chdir: "{{ repo_path | dirname }}"
    creates: "{{ repo_path }}/.jvs"
  when: not repo_stat.stat.exists

- name: Configure repository
  template:
    src: repo_config.yaml.j2
    dest: "{{ repo_path }}/.jvs/config.yaml"
    mode: '0644'
  when: repo_engine or repo_tags
